---
import type { Task, statusType } from '../types/task';
import { statusList } from '../types/task';

interface Props {
  task: Task;
  hideStatus?: boolean;
}

const { task, hideStatus = false } = Astro.props;
---

<script is:inline>
  function updateTitle(id, newTitle) {
    console.log(newTitle);
  }

  function updateContent(id, newContent) {
    console.log(newContent);
  }

  function updateStatus(event) {
    const newStatus = event.target.value;
    console.log(newStatus);
  }

  document.addEventListener('DOMContentLoaded', () => {
    // title edit
    document.querySelectorAll('[id^=js-title-display]').forEach((titleDisplay) => {
      const taskId = titleDisplay.id.replace('js-title-display-', '');
      const titleInput = document.getElementById(`js-title-input-${taskId}`);

      if (!titleInput) return;

      titleDisplay.addEventListener('click', () => {
        titleDisplay.classList.add('hidden');
        titleInput.classList.remove('hidden');
        titleInput.focus();
      });

      titleInput.addEventListener('blur', async (e) => {
        const newTitle = e.target?.value;
        titleDisplay.textContent = newTitle;
        titleDisplay.classList.remove('hidden');
        titleInput.classList.add('hidden');
        updateTitle(taskId, newTitle);
      });

      titleInput.addEventListener('keydown', (e) => {
        if (e.key === 'Enter') {
          titleInput.blur();
        }
      });
    });

    //content edit
    document.querySelectorAll('[id^=js-content-display]').forEach((contentDisplay) => {
      const taskId = contentDisplay.id.replace('js-content-display-', '');
      const contentInput = document.getElementById(`js-content-input-${taskId}`);

      if (!contentInput) return;

      contentDisplay.addEventListener('click', () => {
        contentDisplay.classList.add('hidden');
        contentInput.classList.remove('hidden');
        contentInput.focus();
      });

      contentInput.addEventListener('blur', async (e) => {
        const newContent = e.target?.value;
        contentDisplay.textContent = newContent;
        contentDisplay.classList.remove('hidden');
        contentInput.classList.add('hidden');
        updateContent(taskId, newContent);
      });
    });
  });
</script>
